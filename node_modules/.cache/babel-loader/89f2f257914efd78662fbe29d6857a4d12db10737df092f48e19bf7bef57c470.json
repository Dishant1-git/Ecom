{"ast":null,"code":"const addcart = async () => {\n  if (!Loggedin) {\n    await Swal.fire({\n      icon: 'warning',\n      title: 'Login Required',\n      text: 'Please login to add items to your cart',\n      confirmButtonText: 'OK'\n    });\n    navigate({\n      pathname: '/login',\n      search: `?pid=${idd}`\n    });\n    return;\n  }\n  try {\n    const emaill = email;\n    const quantity = Number(pq) || 1; // Ensure pq is a number\n    const tprice = pprice * quantity;\n\n    // Prepare data for addcart POST\n    const alldata = {\n      pname,\n      pq: quantity,\n      pimg,\n      pprice,\n      pdes,\n      emaill,\n      tprice,\n      productid: idd // use productid key here\n    };\n\n    // Check if product exists in user's cart\n    const checkRes = await fetch(`http://localhost:9000/api/checkcart?username=${emaill}&idd=${idd}`);\n    if (!checkRes.ok) {\n      throw new Error(`Failed to check cart: HTTP ${checkRes.status}`);\n    }\n    const result = await checkRes.json();\n    if (!result || typeof result.statuscode !== 'number') {\n      throw new Error('Invalid server response format');\n    }\n    switch (result.statuscode) {\n      case 2:\n        // product exists - update quantity\n        const updateRes = await fetch(\"http://localhost:9000/api/updatecart\", {\n          method: \"PUT\",\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            username: emaill,\n            productid: idd,\n            newQuantity: quantity,\n            pprice // include price for total calculation\n          })\n        });\n        if (!updateRes.ok) {\n          throw new Error(`Failed to update quantity: HTTP ${updateRes.status}`);\n        }\n        const updateResult = await updateRes.json();\n        if (updateResult.statuscode === 1) {\n          await Swal.fire({\n            icon: 'success',\n            title: 'Success',\n            text: 'Quantity updated in cart!',\n            timer: 2000,\n            showConfirmButton: false\n          });\n        } else {\n          throw new Error(updateResult.message || 'Failed to update quantity');\n        }\n        break;\n      case 3:\n        // product not in cart - add new\n        const addRes = await fetch(\"http://localhost:9000/api/addcart\", {\n          method: \"POST\",\n          body: JSON.stringify(alldata),\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        });\n        if (!addRes.ok) {\n          throw new Error(`Failed to add to cart: HTTP ${addRes.status}`);\n        }\n        const addResult = await addRes.json();\n        if (addResult.statuscode === 1) {\n          await Swal.fire({\n            icon: 'success',\n            title: 'Success',\n            text: 'Product added to cart!',\n            timer: 2000,\n            showConfirmButton: false\n          });\n        } else {\n          throw new Error(addResult.message || 'Failed to add to cart');\n        }\n        break;\n      default:\n        throw new Error(`Unexpected status code: ${result.statuscode}`);\n    }\n\n    // Navigate to cart page after success\n    navigate(\"/addtocart\");\n  } catch (err) {\n    console.error('Cart operation failed:', err);\n    Swal.fire({\n      icon: 'error',\n      title: 'Error',\n      text: err.message || 'Failed to process cart request',\n      confirmButtonText: 'OK'\n    });\n  }\n};","map":{"version":3,"names":["addcart","Loggedin","Swal","fire","icon","title","text","confirmButtonText","navigate","pathname","search","idd","emaill","email","quantity","Number","pq","tprice","pprice","alldata","pname","pimg","pdes","productid","checkRes","fetch","ok","Error","status","result","json","statuscode","updateRes","method","headers","body","JSON","stringify","username","newQuantity","updateResult","timer","showConfirmButton","message","addRes","addResult","err","console","error"],"sources":["C:/Users/ranag/OneDrive/Desktop/reactprojectstudent/src/productdetails.js"],"sourcesContent":["const addcart = async () => {\r\n  if (!Loggedin) {\r\n    await Swal.fire({\r\n      icon: 'warning',\r\n      title: 'Login Required',\r\n      text: 'Please login to add items to your cart',\r\n      confirmButtonText: 'OK'\r\n    });\r\n    navigate({\r\n      pathname: '/login',\r\n      search: `?pid=${idd}`,\r\n    });\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const emaill = email;\r\n    const quantity = Number(pq) || 1; // Ensure pq is a number\r\n    const tprice = pprice * quantity;\r\n\r\n    // Prepare data for addcart POST\r\n    const alldata = { \r\n      pname, \r\n      pq: quantity, \r\n      pimg, \r\n      pprice, \r\n      pdes, \r\n      emaill, \r\n      tprice, \r\n      productid: idd // use productid key here\r\n    };\r\n\r\n    // Check if product exists in user's cart\r\n    const checkRes = await fetch(`http://localhost:9000/api/checkcart?username=${emaill}&idd=${idd}`);\r\n    if (!checkRes.ok) {\r\n      throw new Error(`Failed to check cart: HTTP ${checkRes.status}`);\r\n    }\r\n\r\n    const result = await checkRes.json();\r\n    if (!result || typeof result.statuscode !== 'number') {\r\n      throw new Error('Invalid server response format');\r\n    }\r\n\r\n    switch (result.statuscode) {\r\n      case 2: // product exists - update quantity\r\n        const updateRes = await fetch(\"http://localhost:9000/api/updatecart\", {\r\n          method: \"PUT\",\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            username: emaill,\r\n            productid: idd,\r\n            newQuantity: quantity,\r\n            pprice // include price for total calculation\r\n          })\r\n        });\r\n\r\n        if (!updateRes.ok) {\r\n          throw new Error(`Failed to update quantity: HTTP ${updateRes.status}`);\r\n        }\r\n\r\n        const updateResult = await updateRes.json();\r\n\r\n        if (updateResult.statuscode === 1) {\r\n          await Swal.fire({\r\n            icon: 'success',\r\n            title: 'Success',\r\n            text: 'Quantity updated in cart!',\r\n            timer: 2000,\r\n            showConfirmButton: false\r\n          });\r\n        } else {\r\n          throw new Error(updateResult.message || 'Failed to update quantity');\r\n        }\r\n        break;\r\n\r\n      case 3: // product not in cart - add new\r\n        const addRes = await fetch(\"http://localhost:9000/api/addcart\", {\r\n          method: \"POST\",\r\n          body: JSON.stringify(alldata),\r\n          headers: { 'Content-Type': 'application/json' }\r\n        });\r\n\r\n        if (!addRes.ok) {\r\n          throw new Error(`Failed to add to cart: HTTP ${addRes.status}`);\r\n        }\r\n\r\n        const addResult = await addRes.json();\r\n\r\n        if (addResult.statuscode === 1) {\r\n          await Swal.fire({\r\n            icon: 'success',\r\n            title: 'Success',\r\n            text: 'Product added to cart!',\r\n            timer: 2000,\r\n            showConfirmButton: false\r\n          });\r\n        } else {\r\n          throw new Error(addResult.message || 'Failed to add to cart');\r\n        }\r\n        break;\r\n\r\n      default:\r\n        throw new Error(`Unexpected status code: ${result.statuscode}`);\r\n    }\r\n\r\n    // Navigate to cart page after success\r\n    navigate(\"/addtocart\");\r\n\r\n  } catch (err) {\r\n    console.error('Cart operation failed:', err);\r\n    Swal.fire({\r\n      icon: 'error',\r\n      title: 'Error',\r\n      text: err.message || 'Failed to process cart request',\r\n      confirmButtonText: 'OK'\r\n    });\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}